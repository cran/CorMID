<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>CorMID</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">CorMID</h1>



<p>Please load the <code>CorMID</code> package before running the
examples within this document.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(CorMID)</span></code></pre></div>
<div id="the-cormid-function-to-correct-superimposed-mass-isotopologue-distributions-of-13c-labelled-molecules-in-gc-apci-ms-flux-experiments" class="section level1">
<h1>The CorMID function to correct superimposed mass isotopologue
distributions of <sup>13</sup>C labelled molecules in GC-APCI-MS flux
experiments</h1>
<p>The package provides the main function <code>CorMID</code> which will
estimate the fragment distribution, <em>r</em>, and the mass
isotopologue distribution, <em>M</em>, for a numeric vector of measured
ion intensities originating from a compound analyzed by GC-APCI-MS (see
below).</p>
<div id="definitions" class="section level2">
<h2>Definitions</h2>
<div id="gas-chromatography-gc" class="section level3">
<h3>Gas chromatography (GC)</h3>
<p>Gas chromatography is an analytical method to separate volatile
compounds.</p>
</div>
<div id="atmospheric-pressure-chemical-ionization-apci" class="section level3">
<h3>Atmospheric pressure chemical ionization (APCI)</h3>
<p>Atmospheric pressure chemical ionization (APCI) is an ionization
method used in mass spectrometry which utilizes gas-phase ion-molecule
reactions at atmospheric pressure (10<sup>5</sup> Pa) to convert
molecules separated by GC into ions which can be analyzed by mass
spectrometry.</p>
</div>
<div id="mass-spectrometry-ms" class="section level3">
<h3>Mass spectrometry (MS)</h3>
<p>Mass spectrometry is an analytical method to separate ions due to
their mass, more specifically due to their difference in mass to charge
ratio.</p>
</div>
<div id="mass-isotopologue-distributions-mid" class="section level3">
<h3>Mass Isotopologue Distributions (MID)</h3>
<p>Compounds which have the same sum formula are termed isomers. Isomers
can be structurally different, <em>i.e.</em> the arrangement of the
atoms in the molecules are different, or structurally identical. All
isomers of a specific sum formula which are structurally identical but
differ in their isotopic composition are termed isotopomers. The
specific case of isotopomers with identical isotopic composition but
differences of the position of these isotopes are termed
isotopologues.</p>
<p>Let us look at an example: C<sub>2</sub>H<sub>6</sub>O would be a sum
formula, with ethanol (CH<sub>3</sub>-CH<sub>2</sub>-OH) and dimethyl
ether (CH<sub>3</sub>-O-CH<sub>3</sub>) being two structural isomers of
C<sub>2</sub>H<sub>6</sub>O. The molecules
<sup>13</sup>CH<sub>3</sub>-CH<sub>2</sub>-OH and
CH<sub>3</sub>-CH<sub>2</sub>-OH would be two isotopomers of ethanol as
they differ in their isotopic composition. The molecules
<sup>13</sup>CH<sub>3</sub>-CH<sub>2</sub>-OH and
CH<sub>3</sub>-<sup>13</sup>CH<sub>2</sub>-OH would be isotopologues of
ethanol. Together, they represent the M1 isotopologue of ethanol with
the common sum formula <sup>13</sup>C<sup>12</sup>CH<sub>6</sub>O. The
corresponding M2 isotopologue would be
<sup>13</sup>C<sub>2</sub>H<sub>6</sub>O. In mass spectrometry we
measure the mass isotopologue distribution of
C<sub>2</sub>H<sub>6</sub>O, more specifically of the structural isomer
ethanol because we can separate other structural isomers during the
chromatography preceding the measurement. Hence, the mass isotopologue
distribution (MID) is an intensity vector of 3 different ion masses,
M+0, M+1 and M+2. In this simple case of two carbons and neglecting
<sup>17</sup>O these three isotopologues represent only 4 different
molecules. However, with increasing carbon number the situation is
getting more complex. :)</p>
</div>
<div id="helper-functions" class="section level3">
<h3>Helper functions</h3>
<p>Within the main function <code>CorMID</code> we make use of several
helper functions, <em>i.e.</em> <code>CountChemicalElements</code> and
<code>CalcTheoreticalMDV</code>. The first one simply counts the digit
following a certain letter in a chemical sum formula. Here, we use it to
determine the number of carbon, silicon and sulfur atoms (neglecting
nitrogen, as the <sup>15</sup>N isotope is of low abundance). As the
anticipated user will probably work on derivatized compounds, two
additional letters were included to the chemical alphabet,
<strong>T</strong> for TMS and <strong>M</strong> for a MEOX
substitution. In consequence for compound Glucose (5 TMS, 1 MEOX) we
would count:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>fml <span class="ot">&lt;-</span> <span class="st">&quot;C6H12O6T5M1&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">CountChemicalElements</span>(<span class="at">x =</span> fml)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt;  C  H  O  T  M </span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;  6 12  6  5  1</span></span></code></pre></div>
<p>and receive as output a named vector for all present elements.
Specifying parameter <em>ele</em>, we can also count the occurence of a
selection of elements.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">CountChemicalElements</span>(<span class="at">x =</span> fml, <span class="at">ele =</span> <span class="fu">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;Si&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;Cl&quot;</span>))</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt;  C Si  T Cl </span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;  6  0  5  0</span></span></code></pre></div>
<p>The elements with a significant amount of natural occurring isotopes
are relevant to calculate the theoretical mass distribution vector (or
rather matrix respectively) of the compound. In the above example, the
relevant elements are effectively carbon and silicon.</p>
<pre><code>#&gt;    element isotope    mass abundance [%] abund &gt; 1%
#&gt; 1        H      1H  1.0078         99.99       TRUE
#&gt; 2        H      2H  2.0141          0.01      FALSE
#&gt; 3        C     12C 12.0000         98.93       TRUE
#&gt; 4        C     13C 13.0034          1.07       TRUE
#&gt; 5        O     16O 15.9949         99.76       TRUE
#&gt; 6        O     17O 16.9991          0.04      FALSE
#&gt; 7        O     18O 17.9992          0.21      FALSE
#&gt; 8       Si    28Si 27.9769         92.22       TRUE
#&gt; 9       Si    29Si 28.9765          4.69       TRUE
#&gt; 10      Si    30Si 29.9738          3.09       TRUE</code></pre>
<p>As we have 5 TMS groups, we need to consider in total 21 carbon (6 of
biological origin and 15 in TMS groups) and 5 silicon atoms in our
calculations.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>fml <span class="ot">&lt;-</span> <span class="st">&quot;C21Si5&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">CalcTheoreticalMDV</span>(<span class="at">fml =</span> fml)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">round</span>(td, <span class="dv">4</span>)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;       M+0    M+1    M+2    M+3    M+4    M+5    M+6</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; M0 0.5291 0.2575 0.1475 0.0471 0.0147 0.0034 0.0007</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; M1 0.0000 0.5354 0.2546 0.1464 0.0460 0.0143 0.0032</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; M2 0.0000 0.0000 0.5430 0.2522 0.1457 0.0450 0.0141</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; M3 0.0000 0.0000 0.0000 0.5566 0.2523 0.1466 0.0445</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; M4 0.0000 0.0000 0.0000 0.0000 0.5880 0.2600 0.1519</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; M5 0.0000 0.0000 0.0000 0.0000 0.0000 0.6987 0.3013</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; M6 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 1.0000</span></span></code></pre></div>
<p>The first row of the matrix (M0) gives the relative amounts of all
potential isotopes for C<sub>21</sub>Si<sub>5</sub> assuming natural
abundance conditions. The second row (M1) shows the relative amounts for
isotopologue M1 (containing at least one <sup>13</sup>C at any
position). The final row (M6) shows the relative amounts when all
biological carbon atoms are assumed to be <sup>13</sup>C. The amount of
biological carbon is estimated based on the amount of Si within the
function (21 - 5 x 3 = 6). This might be overwritten by function
parameters specifying the number of C of biological origin <em>nbio</em>
and the number of measured ion signals above the detection limit
<em>nmz</em>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">CalcTheoreticalMDV</span>(<span class="at">fml =</span> fml, <span class="at">nbio =</span> <span class="dv">21</span>, <span class="at">nmz =</span> <span class="dv">21</span>)[<span class="sc">-</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">19</span>), <span class="sc">-</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">19</span>)], <span class="dv">4</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt;       M+0    M+1    M+2    M+3  M+19   M+20   M+21</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; M0  0.529 0.2575 0.1475 0.0471 0.000 0.0000 0.0000</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; M1  0.000 0.5349 0.2544 0.1463 0.000 0.0000 0.0000</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; M2  0.000 0.0000 0.5409 0.2512 0.000 0.0000 0.0000</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; M3  0.000 0.0000 0.0000 0.5469 0.000 0.0000 0.0000</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; M19 0.000 0.0000 0.0000 0.0000 0.678 0.1867 0.1352</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; M20 0.000 0.0000 0.0000 0.0000 0.000 0.7910 0.2090</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; M21 0.000 0.0000 0.0000 0.0000 0.000 0.0000 1.0000</span></span></code></pre></div>
<p>Further, the package contains the convenience function
<code>recMID</code> to reconstruct a measured MID based on a given
<em>corMID,</em> <em>r</em> and sum formula. <code>recMID</code> returns
an object of the similarly named class to allow easy visualization by a
class dependent plot method.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>fml <span class="ot">&lt;-</span> <span class="st">&quot;C9H20O3Si2&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>mid <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;M+H&quot;</span> <span class="ot">=</span> <span class="fl">0.8</span>, <span class="st">&quot;M-H&quot;</span> <span class="ot">=</span> <span class="fl">0.1</span>, <span class="st">&quot;M+H2O-CH4&quot;</span> <span class="ot">=</span> <span class="fl">0.1</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>rMID <span class="ot">&lt;-</span> CorMID<span class="sc">::</span><span class="fu">recMID</span>(<span class="at">mid =</span> mid, <span class="at">r =</span> r, <span class="at">fml =</span> fml)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="fu">round</span>(rMID, <span class="dv">4</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt;    M-2    M-1    M+0    M+1    M+2    M+3    M+4    M+5 </span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; 0.0688 0.0141 0.5568 0.1219 0.1206 0.0850 0.0185 0.0143 </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;recMID&quot;</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">plot</span>(rMID)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The spectrum shown in the above plot would be measured for lactic
acid (2 TMS), assuming 10% of the fully labeled isotopologue M3, natural
abundance, 10% proton loss and 10% of
[M+H]+H<sub>2</sub>O-CH<sub>4</sub>. It is the task of
<code>CorMID</code> to disentangle this overlay of superimposed MIDs and
estimate both, <em>corMID</em> and <em>r</em>.</p>
</div>
</div>
<div id="main-function-cormid" class="section level2">
<h2>Main function <code>CorMID</code></h2>
<div id="idea" class="section level3">
<h3>Idea</h3>
<p>The problem in GC-APCI-MS that we try to overcome is the formation of
fragments forming superimposed MIDs. The ones we identified so far are
[M+H], [M+], [M+H]-H<sub>2</sub> and
[M+H]+H<sub>2</sub>O-CH<sub>4</sub>. If we assume [M+H] to be generally
the most abundant and hence use it as our fix point (base MID, shift =
0), than we observe superimposed MIDs starting at -2, -1 and +2 relative
to [M+H] for [M+], [M+H]-H<sub>2</sub> and
[M+H]+H<sub>2</sub>O-CH<sub>4</sub> respectively.</p>
<p>The basic idea of the correction is that we measure a
superimposed/composite MID of one to several fragments all derived from
the same base MID. This base MID (or correct MID, <em>corMID</em>) is
exactly what we are looking for. Estimating the <em>corMID</em> is
complicated because we do not know the distribution of fragments,
<em>i.e.</em> the amount of the individually occurring fragments or
their ratios to each other respectively. Hence, we have to estimate the
<em>corMID</em> and the ratio vector <em>r</em> which in combination fit
our measurement best.</p>
</div>
<div id="example" class="section level3">
<h3>Example</h3>
<p>Lets start with an artificial Glucose spectrum where 10% is M6
labeled:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>fml <span class="ot">&lt;-</span> <span class="st">&quot;C21Si5&quot;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>td1 <span class="ot">&lt;-</span> <span class="fu">CalcTheoreticalMDV</span>(<span class="at">fml =</span> fml, <span class="at">nbio =</span> <span class="dv">6</span>, <span class="at">nmz =</span> <span class="dv">8</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>bMID <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fl">0.1</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>md1 <span class="ot">&lt;-</span> <span class="fu">apply</span>(td1<span class="sc">*</span>bMID, <span class="dv">2</span>, sum)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">round</span>(md1, <span class="dv">4</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;    M+0    M+1    M+2    M+3    M+4    M+5    M+6    M+7    M+8 </span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; 0.4761 0.2318 0.1327 0.0424 0.0132 0.0030 0.0606 0.0253 0.0149</span></span></code></pre></div>
<p><strong>md1</strong> represents the measured isotopologue
distribution which is equivalent to the vector of measured intensity
values normalized to the vector sum. Please note that the measured MID
contains additional peaks at M+7 and M+8, caused by the natural abundant
isotopes of carbon atoms attached during derivatization. Now we may use
function <code>CorMID</code> to disentangle this vector.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">CorMID</span>(<span class="at">int=</span>md1, <span class="at">fml=</span>fml, <span class="at">r=</span><span class="fu">unlist</span>(<span class="fu">list</span>(<span class="st">&quot;M+H&quot;</span><span class="ot">=</span><span class="dv">1</span>)))</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; [class] &#39;CorMID&#39;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; MID [%] (estimated)</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt;     M0    M1    M2    M3    M4    M5    M6</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;  89.84 00.00 00.00 00.00 00.00 00.00 10.16</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; [attr] &#39;r&#39; (fixed)</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt;   M+H</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt;  1.00</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; [attr] &#39;err&#39;</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; 0.002743</span></span></code></pre></div>
<p>Notice, that we allowed only [M+H] to be present in option
<em>r</em>. The result is a labeled vector representing the corrected
MID (or base MID) and attributes providing information on the fitting
error <em>err</em> and the parameters <em>r</em>atio,
<em>ratio_status</em> and <em>mid_status</em> as used in the function
call. Please note that during the function call <em>mid</em> was
estimated and <em>r</em>atio was fixed.</p>
<p>We could achieve something similar testing for all currently defined
fragments by omitting the <em>r</em> option:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">CorMID</span>(<span class="at">int=</span>md1, <span class="at">fml=</span>fml)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; [class] &#39;CorMID&#39;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; MID [%] (estimated)</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt;     M0    M1    M2    M3    M4    M5    M6</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt;  89.84 00.00 00.00 00.00 00.00 00.00 10.16</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; [attr] &#39;r&#39; (estimated)</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt;   M+H   M+   M-H   M+H2O-CH4</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt;  1.00 0.00  0.00        0.00</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; [attr] &#39;err&#39;</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; 0.002743</span></span></code></pre></div>
<p>Here, we essentially get the same result as before (except for
<em>ratio</em> related attributes) because there is no superimposition
in our test data. <em>ratio</em> was estimated and other possible
adducts were tested but found to be of zero presence. Now lets generate
more difficult composite data <strong>md2</strong> to be fit by
including a 20% proton loss (or “[M+]” or “M-1”, respectively) on top of
<strong>md1</strong>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>md2 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">list</span>(<span class="st">&quot;M-1&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="fl">0.8</span><span class="sc">*</span>md1)) <span class="sc">+</span> <span class="fu">c</span>(<span class="fl">0.2</span><span class="sc">*</span>md1, <span class="dv">0</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">round</span>(md2, <span class="dv">4</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt;    M-1    M+0    M+1    M+2    M+3    M+4    M+5    M+6    M+7    M+8 </span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; 0.0952 0.4273 0.2120 0.1147 0.0365 0.0112 0.0145 0.0535 0.0232 0.0119</span></span></code></pre></div>
<p>We could have done the same with the convenience function
<em>recMID</em>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>fml <span class="ot">&lt;-</span> <span class="st">&quot;C21Si5&quot;</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>bMID <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fl">0.1</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;M+H&quot;</span> <span class="ot">=</span> <span class="fl">0.8</span>, <span class="st">&quot;M+&quot;</span> <span class="ot">=</span> <span class="fl">0.2</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>rMID <span class="ot">&lt;-</span> CorMID<span class="sc">::</span><span class="fu">recMID</span>(<span class="at">mid =</span> bMID, <span class="at">r =</span> r, <span class="at">fml =</span> fml)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">round</span>(rMID, <span class="dv">4</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt;    M-1    M+0    M+1    M+2    M+3    M+4    M+5    M+6    M+7    M+8 </span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; 0.0957 0.4292 0.2129 0.1152 0.0367 0.0112 0.0140 0.0509 0.0221 0.0122 </span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;recMID&quot;</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="fu">plot</span>(rMID, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.45</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAclBMVEUAAAAAADoAAGYAOjoAOpAAZrYil+Yo4uU6AAA6ADo6AGY6Ojo6OpA6ZmY6kNth0E9mAABmADpmtv+QOgCQZgCQ2/+ZmZm2ZgC2///NC7zbkDrbkJDb2//b///fU2vm5ub1xxD/tmb/25D//7b//9v///8Iz6qDAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAI1UlEQVR4nO2dC5frJBSFo050fNU64zUaHTVt8///oiFPCAf2NE1DIHuvpes2MCfNVzhAOEBWU15lob/A3kVAQAQEREBABAREQEAEBERAQAQEREBABAREQEAEBERAQAQEREBABAREQEAEBERAQAQEREBAAQBlnba/8SIREBABAREQEAEBERAQAQERENA937PKsq++aJ+Ll49Ft0wVUNXQqTRCVUZAum7vp+b/RT58vp4JyNDl9a35f/n1H/3n8uU3AtJ1+V7VrmoA1HykDzLUuZ/BCakKZwDKJqFbHgJQ2cBxlKCjAjKqWPuBgAwZTrrsn/JtgclUAc2beZagueYdRQKaq+yGGrf3vPtMQM8xSUAonYBAOgGBdAIC6QQE0gkIpBMQSCcgkE5AIJ2AQDoBgfR4AV3PWb6ySSk9XkDdi7DTuibt9JgB1SswSh1Qh2ic/lrHpJEeN6CqfdN8e1825yWanKdHDKjx0v18crW8CCUM6Ho2ojfWMCmlRwzo147PA8VnblJKjx9QSUCjtO9ZZKPYzI8SS9CKJqX0eAFtY5KAUHqkgK7nk+oGtaKTHsUSBERAQPOhxkkNVZePw2yTQnrEgIqXj8trbgQBPWpSSI8X0PX81ozm3zjU0GQBKho4HGpMmlWx/Hp++bie8/VMCukRA2o6Ql99GSPI5jIWs5SzlS0uk0J6xIC8MmIUVS2sZEJHBWREuar+QO0oaikDur27hxrzxSyHBFR4mq/ZYpZG5eGqWFtxXDLXarQuW889vW1LGpC0tKDXHFDtmhtKGJCzgVeyq5ijGUsYUDvOcMl20v0lv0khPV5A3hdmRjPfoZHHbAkD8svoKKp1Gh2yu00mC8hczKImieT6mDSgdq138ViEUMqAmhpUqtE8Jw5HzZr5U7tal++DJlkdRQWIbxQniSVo4Y4BkkkpPV5AvQ8qPd3Fu00K6RED6rqKD0ZRJQ1oC5MRA2KEmS1GmAExwgyIEWZAdNJAn5/VWGhSSI8YkG9WY6FJIT1eQA8O4yWTUnrMgB4aY0gmpfR4AXlnNZaZlNLjBeSd1VhoUkiPFxDDgG2xHwREQEAEBDR9Ty5FEMUSBERAQAQEREBABAREQECM7gBidAfQPqI7/un0wE2fpnuiO/TFLO3ba7mgJQzIH92hxyje3pt/lPKGXgkD8kZ3CFGuclVMGZAvukNgslogeTyAPBIi7eVZoqMCstdqVLqXziahW8YLyLtY1QJUOTZdTBhQG+Dhii+bV7HKFQOSMqC62wVPLBozJ106Y2QSB1SrBh0uZqk9gZ6JA3KWIKOjeHl1D9cSBtSOH9wxrtpilv7wo6P1gx7cckEyKaXHC2gbkwSE0iMFFHLiMApAm5mMGFCwSPvYAPGV66R9RNrHAShgpH0sgLYxGTOgoZ2nDxo1ex/08lHmji05FpoU0uMFpKZUKzVxuPWi3ngAvdWXH/5o/1vJpJQeLyD1Tky1ZAQ0yXwa1UMsTqximmZPU+SqJXtsUVTSgLYwSUAonYBAeqSAxrdl7EnrYgkCIiCgfUS5RgMoVJRrLIAY5WrrnijXJSal9HgBBdvDLBZAwfYwiwZQqD3M4gG0hckUAP0V3En/0umBr7GS9O9Z9oMwOQRvkUkxPVZAKrxOtV+Va2a1Mt2T68VsqoDarV+anlDpctLGhtsqq6OcpQqoP2zlR0d4+CzKVRWnwwFSvZ/CGbhgxklX2cnV304ckLMTbS1mOSig3JXTXqthAJpeRxLQcIElyNDCKvZ7Jz09WkD+l/bWisOjAUKaNfMEZGnWUSQgS8bJLAS0kkkCAiYJCJgkIGCSgIBJAgImCQiYJCBgkoCASQICJgkImCQgYJKAgEkCAiYJCJgkIGAyOKD/Oi39cwICIiAgAgIiICACAiIgoIgAfdvp3q9DQEAEBERAQAQEREBABAQkAPq306f+nICACAiIgIBSA/RnJ+3KkQF910nPtBCQG9k9gIzVPpVzZeJhARlBnPOITqfJ4wAywoCtmGCnyeMAMgLJP3+2z4EA6UsR7HNsskmfNhmDPv80xmIW+xybVEVAQKtVsVT1BCedlp7QzKelJ3QU09I9bbKx2qd8eBOUOLRFpyWLQwEBfeaue8zkubyq9vjsBLRGJs/lVbXHZyegNTJ5Lq+qPT47Aa2RyXN5Ve3x2QlojUyey6tqj8++K0BRi4CACAiIgIAICIiAgAgIiICACAgoAKD2VPsMnI+jDrRvN443596kqKTpSMbuvIvKtF00/768Tn93PQubjRZZlrffy9qsfntA5bBbbOU577ZsHud6zmsNUPMMp8tPH/1+j7W0r2ELqD09bszU8VHzwMOl6/nn1/mN25MO1C6/9pEizwUk7M3YTTmOX8uX6faunfGhNpkt2lIwnp/XEzZLUM9hyNQ+cTfBOd7u1PxIuf4129tVpvFBTy5B9ubm0287Tu27M6ljTYfC8WZHBHS1xQTUfxoyqb/rf5NKK2aqHubm7bpkK9zg2VVs2FNQuzAvQb5MRV7qj3X7uzZ/ZFWmvCWoLT1lrl0aa1FlFtgwJUh9jZnfG0/t0HyQnWksAMNDjL7IdBONR9MBqWqaG5nUxukaAMnNaD5I+/l6BWjFBp/jPf5lwDhVv7KPTJqxvLx+ox8s3BhXUQO6/6+62+VjDqFt2FMrtraa53roIBmgTQDZBTceBQJkx6YJ0WrBMykRkO9STUD+S3UYQGXXrGiDKvtK+Ey9ArViwQvHTkrQMHC3Bu/Bn30ngJpemRzIGPzZ9wKoLUTxdoLqbXxQ8eAB9kG1jZMup0GO7ZYERxU806StWrHL6zQan7slwVEFzzRqo36Q8cvYbklwVMEz9doAUCW8RbDdkuCogmdSejqgIpOPvCstavaV8JmeDqj0NGCTW3JfCZ8pUE967pbEK+Ez1aHGYrZbEhxV8EytQgCy3ZLgqIJn6hViZnVejAVHFTzTqM0BBe8k77QnHa0ICIiAgAgIiICACAiIgIAICIiAgAgIiICACAiIgIAICIiAgP4Hg76DIJ0utxYAAAAASUVORK5CYII=" /><!-- --></p>
<p>and let <code>CorMID</code> decompose this back…</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">CorMID</span>(<span class="at">int=</span>md2, <span class="at">fml=</span>fml)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; [class] &#39;CorMID&#39;</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; MID [%] (estimated)</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt;     M0    M1    M2    M3    M4    M5    M6</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt;  89.84 00.00 00.00 00.00 00.00 00.00 10.16</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; [attr] &#39;r&#39; (estimated)</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;   M+H   M+   M-H   M+H2O-CH4</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt;  0.80 0.20  0.00        0.00</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; [attr] &#39;err&#39;</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; 0.002466</span></span></code></pre></div>
<p>which is pretty close to the truth. :)</p>
</div>
<div id="more-function-details" class="section level3">
<h3>More Function Details</h3>
<p>Finally, let’s look into the mathematical details of the function.
Apart from some sanity checks and data preparation steps done by the
wrapper function <code>CorMID</code>, the main idea is to model a
theoretical distribution based on a provided sum formula and fit a base
MID and fragment ratios according to measurement data by function
<code>FitMID</code> which is discussed in the following. The approach is
brute force using two nested estimators for <em>r</em> and
<em>corMID</em> separately. It builds on the idea to test a crude grid
of parameters first, identify the best solution and use an iterative
method minimizing the grid to approach the true value.</p>
<p>The grid is set by an internal function <code>poss_local</code>.
Basically, if we have a two carbon molecule we expect a <em>corMID</em>
of length=3 {M0, M1, M2}. Let’s assume that <em>corMID</em> = {0.9, 0,
0.1}. Using a wide grid (step size d= 0.5) we would than test the
following possibilities:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>CorMID<span class="sc">:::</span><span class="fu">poss_local</span>(<span class="at">vec=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">d=</span><span class="fl">0.5</span>, <span class="at">length.out=</span><span class="dv">3</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt;    Var1 Var2 Var3</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; 3   1.0  0.0  0.0</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; 5   0.5  0.5  0.0</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt; 7   0.0  1.0  0.0</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; 11  0.5  0.0  0.5</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; 13  0.0  0.5  0.5</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; 19  0.0  0.0  1.0</span></span></code></pre></div>
<p>and identify {1, 0, 0} as best match after subjecting to a testing
function. Taking the best match as our new starting point, we decrease
the step size of the grid by 50% and test in the next iteration:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>CorMID<span class="sc">:::</span><span class="fu">poss_local</span>(<span class="at">vec=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">d=</span><span class="fl">0.25</span>, <span class="at">length.out=</span><span class="dv">3</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt;     Var1  Var2  Var3</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; 3  1.000 0.000 0.000</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; 5  0.875 0.125 0.000</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; 7  0.750 0.250 0.000</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; 11 0.875 0.000 0.125</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; 13 0.750 0.125 0.125</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; 19 0.750 0.000 0.250</span></span></code></pre></div>
<p>and will get closer to the truth and find {0.875, 0, 0.125} to give
the lowest error.</p>
<p>In summary, using this approach we can approximate the optimal
vectors of <em>corMID</em> and <em>r</em> in a finite number of
iterations to reach a desired precision &lt;0.1%. We can nest MID
fitting inside ratio fitting and thereby do both in parallel.</p>
<p>The error function currently employed is simply the square root of
the summed squared errors, comparing the provided measurement data and a
reconstructed MID based on a specific <em>corMID</em> and
<em>r</em>.</p>
</div>
</div>
<div id="wrap-up" class="section level2">
<h2>Wrap up</h2>
<p>Thanks for following till the end. I hope this framework is helpful
for you.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
